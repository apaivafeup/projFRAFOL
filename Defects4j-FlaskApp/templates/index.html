{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} Welcome to FRAFOL {% endblock %}</h1>
    <div class="menu">
        <div class="sub_menu" id="checkout_project">
            <h5>Import Project to Test:</h5>
            <form id="importForm" action="javascript:checkout()">
                <div class="menu_block">
                    <div class="menu_item"> 
                        <label for="select_menu_one">Project</label><br>
                        <select name="select_project" id="select_menu_one" onchange="get_versions()">
                        {% for item in all_data[0] %}
                        <option value="{{ item }}">{{ item }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <div class="menu_item">
                        <label for="version">Version</label><br>
                        <select name="select_version" id="version" name="version"></select>
                    </div>
                </div>
                <div class="input-group">
                    <button type="submit" class="submit" id="importBtn">
                        <span class="submit__text">Import</span>
                    </button>
                </div>
            </form>
        </div>
        <div class="sub_menu" id="load_project">
            <h5>Open Project:</h5>
            <form id="loadForm" action="javascript:load()">
                <div class="menu_block">
                    <div class="menu_item">
                        <label for="select_menu_two">Project</label><br>
                        <select name="project" id="select_menu_two">
                        {% for item in all_data[1] %}
                        <option value="{{ item }}">{{ item }}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <div class="menu_item">
                        <label for="tool">Mutation Tool</label><br>
                        <select name="select_tool" id="tool">
                            <option value="major">MAJOR</option>
                            <option value="pit">PIT</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <button type="submit" class="submit" id="openBtn">
                        <span class="submit__text">Open</span>
                    </button>
                </div>
            </form>
        </div>
        <div id="warning" hidden>
            <h5> This project is unavailable for PIT. </h5>
        </div>
    </div>
    <script>
        function checkSelection() {
            let warning = document.getElementById("warning");
            let element1 = document.getElementById("select_menu_two");
            let element2 = document.getElementById("tool");
            let submitButton = document.getElementById("openBtn");
            
            if (element2.value == "pit") {
                if (element1.value == "Cli-32" || element1.value == "Gson-15" || element1.value == "Lang-53") {
                    submitButton.disabled = false;
                    warning.setAttribute("hidden", "hidden");
                } else {
                    submitButton.disabled = true;
                    warning.removeAttribute("hidden");
                }
            }
        }

        function get_versions() {
        var project = document.getElementById('select_menu_one').value;

        console.log("project: " + project);

        fetch('/project_versions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ project: project })
        })
        .then(response => response.json())
        .then(data => {
            // Get a reference to the select element
            var selectElement = document.getElementById("version");

            // Clear existing options
            selectElement.innerHTML = '';

            console.log(data.versions);

            // Update existing options
            for (let i = 0;  i < data.versions.length; i++) {
              var option = document.createElement("option");
              option.text = data.versions[i];
              option.value = data.versions[i];
              selectElement.add(option);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
      }

      window.onload = get_versions;
    </script>
{% endblock %}